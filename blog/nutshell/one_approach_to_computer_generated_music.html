<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>One Approach to Computer Generated Music</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="icon" href="/images/favicon.ico">
		<link rel="stylesheet" href="/assets/css/main.css" />
		<link rel="stylesheet" href="/assets/css/fontawesome-all.min.css" />
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
								<div data-include="/components/header"></div>

							<!-- Content -->
								<section>
									<header class="main">
										<h1>One Approach To Computer Generated Music</h1>
									</header>
									<span class="image main"><img src="/images/robot_playing_piano.jpg" alt="Robot playing piano" /></span>
									<div style="margin-left: 30%; margin-right: 30%;">
										<ul class="actions fit">
											<li><a href="/blog/nutshell/one_approach_to_computer_generated_music.html" class="button primary fit">Nutshell</a></li>
											<li><a href="/blog/technical/one_approach_to_computer_generated_music.html" class="button fit">Technical</a></li>
										</ul>
									</div>
									<hr class="major" />
									<h2>Table of Contents</h2>
										<ul>
											<li><a href="#introduction">Introduction</a></li>
											<li><a href="#musical-terms">Musical Terms</a></li>
											<li><a href="#the-progression-generator">The Progression Generator</a></li>
											<li><a href="#the-rhythms-generator">The Rhythms Generator</a></li>
											<li><a href="#the-notes-assigner">The Notes Assigner</a></li>
											<li><a href="#a-piece-generated-by-the-models">A Piece Generated By The Models</a></li>
											<li><a href="#final-remarks">Final Remarks</a></li>
											<li><a href="#citations">Citations</a></li>
										</ul>
									<hr class="major" />
									<h2 id="introduction">Introduction</h2>
										<p>Music is an expression of emotion, shared with its listeners through skilled usage of instruments. Music can also be defined as a sequence of sounds over time. Computers tend to prefer this more simplistic second definition.</p>
										<p>For example, it is easy to tell a computer to randomly select some number of notes from a piano's <em>C, D, E, F, G, A, B</em>, and play each selected note for half a second.</p>
										<p>While this process could generate the melodies of famous pieces, it is very unlikely to. Besides, good songs often involve more components, such as rhythm and <a href="https://en.wikipedia.org/wiki/Chord_progression">chord progressions</a>. (I'll provide some examples for this and other relevant musical terms).</p>
										<p>The <a href="https://hal.inria.fr/hal-01257155/document">paper</a> which inspired this blog post provides the following template for a computer to generate good music with:</p>
										<img class="image" src="/images/composition_sequence_and_related_models.png" alt="Composition sequence and related models" width="80%" style="display: block; margin-left: auto; margin-right: auto;"/><br><br>
										<p>Don't worry about the specifics. It basically says that by specifying a few musical elements of a song, such as the <a href="https://en.wikipedia.org/wiki/Key_(music)">key</a>, <a href="https://en.wikipedia.org/wiki/Tempo">tempo</a> and length, and inputing them into a computer, you can generate a nice song with the inputted key, tempo and length.</p>
										<p>Note that the middle layer consists of three models. Each model is a sub-component of the overall process that generates some element of the output song. For example, the <em>Progression Generator</em> generates the song's chord progressions.</p>
										<p>The purpose of this blog post is to briefly explain how each model works, with a heavier focus on the <em>Progression Generator</em>, simply because I think it is the coolest.</p>
									<hr class="major" />
									<h2 id="musical-terms">Musical Terms</h2>
										<p>But first, some musical terms.</p>
										<p>All melodies and chords consist of <a href="https://en.wikipedia.org/wiki/Musical_note"><em>notes</em></a> (for example, <em>C</em> on a piano). A melody is a sequences of notes played over time. For example:</p>
										<audio controls style="margin: auto; display: block;" src="https://upload.wikimedia.org/wikipedia/commons/8/81/Piano_melody_%28Gravity_Sound%29.wav">Simple example melody audio. Your browser does not support the audio element.</audio><br><br>
										<p>A <a href="https://en.wikipedia.org/wiki/Chord_(music)"><em>chord</em></a> is multiple notes playing at the same time. A <a href="https://en.wikipedia.org/wiki/Chord_progression"><em>chord progression</em></a> is a sequence of chords played over time. For example:</p>
										<audio controls style="margin: auto; display: block;" src="https://upload.wikimedia.org/wikipedia/commons/5/5a/C_major%2C_Middle_C%2C_I-IV-V-I_chord_progression.ogg">C major chord progression audio. Your browser does not support the audio element.</audio><br>
										<p>This chord progression consists of four chords.</p>
										<p>The chords sound good together because they contain notes from the same <a href="https://en.wikipedia.org/wiki/Key_(music)"><em>key</em></a>. A key is a group of notes. In this case, the chords are from the key <em>C major</em>, which is the name for the group of notes <em>C, D, E, F, G, A, B</em>. Here is what these notes sound like:</p>
										<audio controls style="margin: auto; display: block;" src="https://upload.wikimedia.org/wikipedia/commons/7/72/C_major.ogg">C major scale audio. Your browser does not support the audio element.</audio><br>
										<p>The audio is of the <em>C major scale</em>, which is the playing of the notes <em>C, D, E, F, G, A, B, C, B, A, G, F, E, D, C</em>.</p>
										<p>The ordering of the notes in each key is deliberate. In the <em>C major</em> key, the first note, <em>C</em>, has the lowest <a href="https://en.wikipedia.org/wiki/Pitch_(music)"><em>pitch</em></a>. Meanwhile the seventh note, <em>B</em>, has the highest pitch.</p>
										<p>In the same way that notes have names, chords have names too. The chord consisting of the notes <em>C, E, G</em> is the first chord in the <em>C major</em> key (since the chord's lowest pitch note is the note with the lowest pitch in the key), so it is referred to as <em>I</em> (1). Thus, chord progression you listened to above can be described by <em>I-IV-V-I</em>.</p>
										<p>While notes are the base block for melodies and chords, <a href="https://en.wikipedia.org/wiki/Beat_(music)"><em>beats</em></a> are the base block for rhythm. For example, the <a href="https://en.wikipedia.org/wiki/Tempo"><em>tempo</em></a> of a song is the speed of the song, and is measured in beats per minute.</p>
									<hr class="major" />
									<h2 id="the-progression-generator">The Progression Generator</h2>
										<p>The <em>Progression Generator</em> generates a chord progression. In the <a href="#introduction">Introduction</a>, I said that we could easily generate a melody by telling a computer to randomly select some number of notes from a piano's <em>C, D, E, F, G, A, B</em>. So surely we can easily generate a chord progression by telling a computer to randomly select some number of chords from a piano's <em>I, II, III, IV, V, VI, VII</em>?</p>
										<p>While this is true, in the same way that random combinations of notes often sound bad together, random combinations of chords also often sound bad together too.</p>
										<p>Fortunately, music theory tells us what chord progressions sound good together. So, we want to somehow restrict the computer's choices to combinations of chords that sound better than say <em>I-I-I-I</em>.</p>
										<p>Enter, <a href="https://en.wikipedia.org/wiki/Context-free_grammar">context-free grammars</a> and <a href="https://en.wikipedia.org/wiki/Probabilistic_context-free_grammar">probabilistic context-free grammars</a>.</p>
										<p>
											Loosely, a context-free grammar (CFG) is a set of rules and symbols that defines a language. So for example, in English, every word belongs to some <a href="https://en.wikipedia.org/wiki/Syntactic_category">category</a> â€” every word is either a noun, verb, adjective, etc. We can define the relationship between adjectives and nouns with the following rule:
											<div style="text-align: center">\(Noun \rightarrow Adjective\;Noun\)</div>
										</p>
										<p>This essentially means, whenever you have a noun, you can replace it with an adjective and then that noun. For example, if I start with the noun 'Omer', I can replace it with 'clever Omer'. I can repeat this again, since my phrase still contains a noun, and generate 'clever sexy Omer'. I could keep going. Shall I? stop it ;)</p>
										<p>
											A probabilistic context-free grammar (PCFG) is just a CFG with probabilities attached to the rules. So for example, I could describe the tossing of a coin with a PCFG with these rules:</p>
											<div style="text-align: center">
												\[Coin \rightarrow heads\quad[50\%]\]
												\[ Coin \rightarrow tails\quad\;\:[50\%]\]
											</div>
										</p>
										<p>This means that every symbol <em>Coin</em> has a 50% chance of becoming <em>heads</em> or <em>tails</em>. So, to toss two coins, I can feed the PCFG the phrase '<em>Coin Coin</em>', and let the rules and their probabilities generate the outcome.</p>
										<p>Now we are ready to make sense of the <em>Progression Generator</em> proposed in the paper that inspired this blog post. It is defined by a PCFG, whose rules and probabilities represent common chord progressions. As you can imagine, it is quite complicated, and consists of many rules and symbols. If this isn't so clear, imagine how many rules and symbols we would have to add to our above CFG to encapsulate all of the grammatical rules in the English language.</p>
										<p>Let's take a look at a short, high-probability output from the PCFG:</p>
										<p>1) We start with the starting symbol \(S'\).</p>
										<p>2) We replace \(S'\) with the symbols \(S\;F\) by applying one of the rules of the PCFG. \(S\) is supposed to represent a general chord progression, and \(F\) is supposed to represent a finishing chord progression.</p>
										<p>3) We replace the \(S\) in \(S\;F\) with the sequence \(T\;S_1\;D\;T\;S\), and we replace the \(F\) with \(T\;D\;T\). Notice that in the same way that our earlier rule</p>
										<p>\[ Noun \rightarrow Adjective\;Noun\]</p>
										<p>includes <em>Noun</em> on both sides, the rule we applied here includes <em>S</em> on both sides. This just means that we can keep applying the same rule. Earlier, I repeatedly applied the rule to flatter myself â€” here, we can repeatedly apply the rule to generate as many sequences of chords as we would like.</p>
										<p>4) We have the phrase \(T\;S_1\;D\;T\;S\;T\;D\;T\). Let's apply rules to replace every \(T\) with an <em>I</em>, \(S_1\) with <em>IV</em>, every \(D\) with a <em>V</em>, and let's just drop the \(S\). Finally, we have applied enough rules to the abstract symbols to recover a sequence of chords! We have ended up with <em>I-IV-V-I-I-V-I</em>.</p>
										<p>Here's what the chord progression sounds like:</p>
										<audio controls style="margin: auto; display: block;" src="https://upload.wikimedia.org/wikipedia/commons/b/bc/C_major%2C_Middle_C%2C_I-IV-V-I-I-V-I_chord_progression.ogg">C major chord progression audio. Your browser does not support the audio element.</audio><br><br>
										<p>I generated another chord progression, <em>I-IV-V-I-III-VII-VI-III-V-I</em>, by applying different rules to the symbols. Here's how this one sounds:</p>
										<audio controls style="margin: auto; display: block;" src="https://upload.wikimedia.org/wikipedia/commons/8/8f/C_major%2C_Middle_C%2C_I-IV-V-I-III-VII-VI-III-V-I_chord_progression.ogg">C major chord progression audio. Your browser does not support the audio element.</audio><br><br>
										<p>The longer sequence does a better job of showcasing the range of musical ideas embedded in the PCFG. If you have some knowledge of music theory, I encourage you to take a look at the rules given in the <a href="https://hal.inria.fr/hal-01257155/document">paper</a> [pages 6 and 7], and see if you can recognize any common chord progressions.</p>
										<p>Although the PCFG successfully produces pleasant chord progressions, there are considerable limitations.</p>
										<p>For example, <a href="https://en.wikipedia.org/wiki/Cross-serial_dependencies">cross-serial dependencies</a> cannot be captured by the rules of any PCFG:</p>
										<img class="image" src="/images/cross-serial_dependency.png" alt="Cross-serial dependencies" width="60%" style="display: block; margin-left: auto; margin-right: auto;"/><br><br>
										<p>Imagine that \(w_1\) and \(v_1\) are the same chord progression, and that \(w_2\) and \(v_2\) are also the same chord progression. This pretty interleaving of chord progressions, which represents a valid and probably enjoyable musical idea, is impossible to produce with a PCFG.</p>
									<hr class="major" />	
									<h2 id="the-rhythms-generator">The Rhythms Generator</h2>
										<p>The <em>Rhythms Generator</em> generates a rhythm for the piece by assigning durations to each note and chord.</p>
										<p>The authors of the paper define three categories for each <a href="https://en.wikipedia.org/wiki/Bar_(music)"><em>measure</em></a> (small segment of a song) in a piece:</p>
										<ul>
											<li><em>Normal measures</em>: Segments of the song with no radical meaning</li>
											<li><em>Special measures</em>: Pivotal segments with special meaning</li>
											<li><em>Final measures</em>: Final sections of a musical idea, or the entire piece</li>
										</ul>
										<p>The duration of each note and chord is determined by the category of the measure it belongs to. Each category has different probabilities of containing short and long duration notes and chords.</p>
										<p>One helpful observation is that the final measures have a high chance of containing notes and chords with a longer duration, presumably to add significance.</p>
									<hr class="major" />	
									<h2 id="the-notes-assigner">The Notes Assigner</h2>
										<p>The <em>Notes Assigner</em> assigns notes to form the melody.</p>
										<p>The first note of each small segment of the song is selected to match the base of the first chord for that section. For example, if a segment begins with the chord <em>C-E-G</em>, the first note in that segment's melody will be a <em>C</em>.</p>
										<p>The remaining notes are determined with probability in such a way that there is a high-likelihood of generating a pleasant sounding melody. The trick is to assign probabilities to the next note relative to the current note, since we understand these relative relationships well.</p>
										<p>For example, with a current chord and note of <em>C-E-G</em> and <em>C</em>, we assign a high chance of the next note being <em>E</em> or <em>G</em>, to mirror the <em>C-E-G</em> notes of the current chord.</p>
									<hr class="major" />	
									<h2 id="a-piece-generated-by-the-models">A Piece Generated By The Models</h2>
										<p>The following piece, with a key of <em>G major</em>, a tempo of 110 beats per minute, and a length of approximately 25 bars, was generated by all three models:</p>
										<p><img class="image" src="/images/sugerencia_sheet_music.png" alt="Composition sequence and related models" width="65%" style="display: block; margin-left: auto; margin-right: auto;"/></p>
										<p><audio controls style="margin: auto; display: block;" src="https://upload.wikimedia.org/wikipedia/commons/5/5d/Sugerencia.ogg">Sugerencia audio. Your browser does not support the audio element.</audio></p>
										<p>The authors provide some analysis of the piece:</p>
										<p>"The songâ€™s initial <a href="https://en.wikipedia.org/wiki/Tonality"><em>tonality</em></a> [key] is <em>G major</em> modulating to its relative minor (<em>G minor</em>) at measure \(6\) [last section on the first line of the sheet music] and keeping this tonality until finishing. Harmonically the song is marking the progression <em>I-VI-I</em> and the progression <em>I-III-I</em> with an intersection containing the common progression <em>I-II-V7-I</em> and finally finishing in the <a href="https://en.wikipedia.org/wiki/Degree_(music)"><em>tonic degree</em></a> (<em>G minor</em>) [the base chord].</p>
										<p>Melodically the song is overall simple having upward intervals to make a tension or climax at various points (measures \(3, 8, 10, 13, 16, 21\)) and then with downward intervals to relieve the ear of this. It is to note that the climax at bar 16 coincides with the chord <em>V7</em> (this chord has a bit of <a href="https://en.wikipedia.org/wiki/Consonance_and_dissonance">dissonance</a> [harshness]).</p>
										<p>Rhythmically there were two basic rhythms generated for the bass and the melody line, the reader may see that the trivial rhythm for the base (just one whole note) has a more complex counterpart in the melody each time it is played. The other two rhythms are fairly normal that make way to the following more complex rhythm. Also the global rhythm is far from chaotic."</p>
									<hr class="major" />	
									<h2 id="final-remarks">Final Remarks</h2>
										<p>I was ecstatic when first discovering the paper underlying this blog post, because after learning that one can create <a href="http://www.cs.uccs.edu/%7Ejkalita/work/cs589/2010/12Grammars.pdf">CFGs that describe the main structures of the English language</a> [page 6], I was curious to further explore the expressive power of CFGs. Eventually, I had the idea of applying it to the language of music, which prompted my discovery of the paper.</p>
										<p>The paper does a great job of providing preliminary analytical tools and models for describing Bach's compositions, and music theory in general, in terms of a framework that computers understand.</p>
										<p>Nonetheless, I am disappointed by the paper's general lack of rigour and completeness when describing and showcasing each model. Detail is missing to recreate everything oneself. The link provided on page 11 to see other generated pieces and play around with a beta version of the assistant is broken.</p>
										<p>It would be cool to push the embedded ideas and models further, perhaps using more sophisticated tools (i.e. probabilistic <a href="https://en.wikipedia.org/wiki/Context-sensitive_grammar">CSGs</a> and probabilistic <a href="https://en.wikipedia.org/wiki/Unrestricted_grammar">unrestricted grammars</a>), and even trying to integrate the disjoint models together, to provide more cohesion among the different components of the generated pieces.</p>
									<hr class="major" />	
									<h2 id="citations">Citations</h2>
										<p><strong>Post image</strong>: "Robot music" by <a href="https://unsplash.com/@possessedphotography">Possessed Photography</a>, hosted by <a href="https://unsplash.com/photos/U3sOwViXhkY">Unsplash</a>, <a href="https://unsplash.com/license">license</a></p>
										<p><strong>Underlying paper</strong>: Salim Perchy, Gerardo Sarria. Musical Composition with Stochastic Context-Free Grammars. 8th Mexican International Conference on Artificial Intelligence (MICAI 2009), Nov 2009, Guanajuato, Mexico. hal-01257155, <a href="https://hal.inria.fr/hal-01257155/document">URL</a></p>
										<strong>Introduction</strong>
										<ul>
											<li><a href="https://en.wikipedia.org/wiki/Chord_progression">Chord progression</a></li>
											<li>Fig. 3., Salim Perchy, Gerardo Sarria. Musical Composition with Stochastic Context-Free Grammars. 8th Mexican International Conference on Artificial Intelligence (MICAI 2009), Nov 2009, Guanajuato, Mexico. hal-01257155</li>
											<li><a href="https://en.wikipedia.org/wiki/Key_(music)">Key</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Tempo">Tempo</a></li>
										</ul>
										<strong>Musical Terms</strong>
										<ul>
											<li><a href="https://en.wikipedia.org/wiki/Musical_note">Note</a></li>
											<li><a href="https://upload.wikimedia.org/wikipedia/commons/8/81/Piano_melody_%28Gravity_Sound%29.wav">Melody audio</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Chord_(music)">Chord</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Chord_progression">Chord progression</a></li>
											<li><a href="https://upload.wikimedia.org/wikipedia/commons/5/5a/C_major%2C_Middle_C%2C_I-IV-V-I_chord_progression.ogg">C major chord progression audio</a></li>
											<li><a href="https://upload.wikimedia.org/wikipedia/commons/7/72/C_major.ogg">C major scale audio</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Key_(music)">Key</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Pitch_(music)">Pitch</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Beat_(music)">Beat</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Tempo">Tempo</a></li>
										</ul>
										<strong>The Progression Generator</strong>
										<ul>
											<li><a href="https://en.wikipedia.org/wiki/Context-free_grammar">Context-free grammar</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Probabilistic_context-free_grammar">Probabilistic context-free grammar URL 1</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Syntactic_category">Syntactic category</a></li>
											<li><a href="https://upload.wikimedia.org/wikipedia/commons/b/bc/C_major%2C_Middle_C%2C_I-IV-V-I-I-V-I_chord_progression.ogg">Chord progression audio</a></li>
											<li><a href="https://upload.wikimedia.org/wikipedia/commons/8/8f/C_major%2C_Middle_C%2C_I-IV-V-I-III-VII-VI-III-V-I_chord_progression.ogg">Chord progression audio</a></li>
											<li>pp. 6-7, Salim Perchy, Gerardo Sarria. Musical Composition with Stochastic Context-Free Grammars. 8th Mexican International Conference on Artificial Intelligence (MICAI 009), Nov 2009, Guanajuato, Mexico. ffhal-01257155</li>
											<li><a href="https://en.wikipedia.org/wiki/Cross-serial_dependencies">Cross-serial dependencies</a></li>
											<li><a href="https://commons.wikimedia.org/w/index.php?curid=28274222">Image of cross-serial dependencies</a>: By Christian Nassif-Haynes - Own work, <a href="https://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a></li>
										</ul>
										<strong>The Rhythms Generator</strong>
										<ul>
											<li><a href="https://en.wikipedia.org/wiki/Bar_(music)">Measure</a></li>
											<li>pp. 7-9, Salim Perchy, Gerardo Sarria. Musical Composition with Stochastic Context-Free Grammars. 8th Mexican International Conference on Artificial Intelligence (MICAI 009), Nov 2009, Guanajuato, Mexico. ffhal-01257155</li>
										</ul>
										<strong>The Notes Assigner</strong>
										<ul>
											<li>pp. 9, Salim Perchy, Gerardo Sarria. Musical Composition with Stochastic Context-Free Grammars. 8th Mexican International Conference on Artificial Intelligence (MICAI 009), Nov 2009, Guanajuato, Mexico. ffhal-01257155</li>
										</ul>
										<strong>A Piece Generated By The Models</strong>
										<ul>
											<li>pp. 10-11, Salim Perchy, Gerardo Sarria. Musical Composition with Stochastic Context-Free Grammars. 8th Mexican International Conference on Artificial Intelligence (MICAI 2009), Nov 2009, Guanajuato, Mexico. hal-01257155</li>
											<li><a href="https://upload.wikimedia.org/wikipedia/commons/5/5d/Sugerencia.ogg">Sugerencia audio</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Tonality">Tonality</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Degree_(music)">Degree</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Consonance_and_dissonance">Dissonance</a></li>
										</ul>
										<strong>Final Remarks</strong>
										<ul>
											<li><a href="http://www.cs.uccs.edu/%7Ejkalita/work/cs589/2010/12Grammars.pdf">Context-free grammars for English</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Context-sensitive_grammar">Context-sensitive grammars</a></li>
											<li><a href="https://en.wikipedia.org/wiki/Unrestricted_grammar">Unrestricted grammars</a></li>
										</ul>
										
								</section>

						</div>
					</div>

				<!-- Sidebar -->
					<div id="sidebar">
						<div class="inner">
							<div data-include="/components/sidebar"></div>
						</div>
					</div>

			</div>

		<!-- Scripts -->
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/browser.min.js"></script>
			<script src="/assets/js/breakpoints.min.js"></script>
			<script src="/assets/js/util.js"></script>
			<script src="/assets/js/main.js"></script>
			<script id="MathJax-script" async="false" src="/assets/mathjax/tex-chtml.js"></script>
			<script>
			$(function () {  /* include other HTML files */
				var includes = $('[data-include]')
				$.each(includes, function () {
					var file = $(this).data('include') + '.html'
					$(this).load(file)
				})
			})
			</script>

	</body>
</html>